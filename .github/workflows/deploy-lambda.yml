# â€¦ desencadenadores, checkout, creds, etc â€¦

- name: ðŸ—ï¸ Build, Tag & Push Docker image
  run: |
    IMAGE_TAG=$(date +'%Y%m%d%H%M%S')
    IMAGE_URI="${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/${ECR_REPOSITORY}:${IMAGE_TAG}"
    echo "IMAGE_TAG=$IMAGE_TAG" >> $GITHUB_ENV
    docker build -t $IMAGE_URI .
    docker push $IMAGE_URI

- name: ðŸš€ SAM Deploy
  env:
    IMAGE_TAG: ${{ env.IMAGE_TAG }}
  run: |
    sam deploy \
      --stack-name       $STACK_NAME \
      --region           $AWS_REGION \
      --capabilities     CAPABILITY_IAM CAPABILITY_NAMED_IAM \
      --parameter-overrides \
          JiraDomainParam=$JIRA_DOMAIN \
          JiraUserParam=$JIRA_USER \
          JiraApiTokenParam=$JIRA_API_TOKEN \
          OutputS3Bucket=$OUTPUT_S3_BUCKET \
          ImageTagParam=$IMAGE_TAG \
      --no-fail-on-empty-changeset \
      --no-confirm-changeset
